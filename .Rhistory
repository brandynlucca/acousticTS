panel.spacing.x = ggplot2::unit( 0 , "lines" ) ,
axis.text.y = ggplot2::element_blank( ) ,
axis.title.x = ggplot2::element_blank( ) ,
axis.title.y = ggplot2::element_blank( ) )
} else {
top <- top +
ggplot2::theme( text = ggplot2::element_text( size = 16.75 ,
color = 'black' ) ,
axis.text = ggplot2::element_text( size = 15.75 ,
color = 'black' ) ,
axis.text.x = ggplot2::element_blank( ) ,
axis.title.x = ggplot2::element_blank( ) ,
axis.ticks.length.x = ggplot2::unit( 0 , "lines" ) ,
panel.grid = ggplot2::element_blank( ) ,
plot.margin = ggplot2::margin( 0.5 , 0.5 , 0 , 0 ) ,
strip.text = ggplot2::element_blank( ) ,
legend.text = ggplot2::element_text( hjust = 0 ) ,
panel.spacing.x = ggplot2::unit( 0 , "lines" )
)
bottom <- bottom +
ggplot2::theme( text = ggplot2::element_text( size = 16.75 ,
color = 'black' ) ,
axis.text = ggplot2::element_text( size = 15.75 ,
color = 'black' ) ,
panel.grid = ggplot2::element_blank( ) ,
plot.margin = ggplot2::margin( 0.5 , 0.5 , 0 , 0 ) ,
strip.text = ggplot2::element_blank( ) ,
legend.text = ggplot2::element_text( hjust = 0 ) ,
panel.spacing.x = ggplot2::unit( 0 , "lines" )
)
}
top / bottom +
patchwork::plot_layout( heights = base::c( 4 , 2 ) )
}
( (
plot_fun( shrimp %>%
dplyr::filter( Animal == "917" ) ,
blank = F ,
alt_x = T )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "336" ) ,
blank = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "176" ) ,
alt_x = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "84" ) %>%
dplyr::mutate( Frequency = Frequency * 1e3 ) ,
blank = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) ) +
plot_layout( guides = 'collect' ,
widths = base::c( 2 , 1 , 2 , 1 ) )
plot_fun <- function( tib , blank = T , alt_x = F ) {
tib %>%
ggplot2::ggplot(
mapping = ggplot2::aes( x = Frequency ,
group = Group )
) +
ggplot2::geom_line(
mapping = ggplot2::aes( y = ymin ,
group = Group ) ,
color = 'gray50' ,
size = 1.05
) +
ggplot2::geom_line(
mapping = ggplot2::aes( y = ymax ,
group = Group ) ,
color = 'gray50' ,
size = 1.05
) +
ggplot2::geom_line(
mapping = ggplot2::aes( y = TS_theory ,
color = "B" ) ,
size = 1.5
) +
ggplot2::geom_line(
mapping = ggplot2::aes( y = TS ,
color = "A" ) ,
size = 1.5
) +
ggplot2::geom_ribbon( ggplot2::aes( ymin = TS_min ,
ymax = TS_max ,
fill = "A" ) ,
alpha = 0.30 ) +
ggplot2::geom_ribbon( ggplot2::aes( ymin = ymin ,
ymax = ymax ,
fill = "B" ) ,
alpha = 0.00 ) +
ggplot2::scale_color_manual(
name = NULL ,
values = c( "red" ,
"black" ) ,
labels = c( expression( bar(italic('TS'))['E']) ,
'Best-fit'~italic('TS')['M'] )) +
ggplot2::scale_fill_manual(
name = NULL ,
values = c( "#fc9272" ,
"gray50" ) ,
drop = F ,
labels = c( expression( Range(italic('TS')['E']) ) ,
expression( Range(italic('TS')['M']))) ) +
ggplot2::scale_x_continuous(
breaks = base::c( 40 , 45 , 50 , 55 , 60 , 65 ,
130 , 150 , 170 , 190 , 210 )
) +
ggplot2::facet_wrap( ~ Group + Animal ,
scales = "free_x" ) +
ggplot2::coord_cartesian(
ylim = base::c( -95 , -48 ) ,
expand = 0
) +
ggplot2::theme_bw( ) +
# ggplot2::theme( text = ggplot2::element_text( size = 16.75 ,
#                                               color = 'black' ) ,
#                 axis.text = ggplot2::element_text( size = 15.75 ,
#                                                    color = 'black' ) ,
#                 panel.grid = ggplot2::element_blank( ) ,
#                 # # axis.title.y = ggplot2::element_blank( ) ,
#                 axis.text.x = ggplot2::element_blank( ) ,
#                 axis.title.x = ggplot2::element_blank( ) ,
#                 strip.text = ggplot2::element_blank( ) ,
#                 axis.ticks.length.x = ggplot2::unit( 0 , "lines" ) ,
#                 plot.margin = ggplot2::margin( 0 , 0 , 0 , -0.5 ) ,
#                 legend.text = ggplot2::element_text( hjust = 0 ) ,
#                 panel.spacing.x = ggplot2::unit( 0 , "lines" ) ) +
ggplot2::labs( x = "Frequency (kHz)" ,
y = expression( italic('TS')~('dB'~'re.'~1~'m'^2) ) ) +
facet_labs +
ggplot2::geom_text( ggplot2::aes( x = x ,
y = y ,
label = label ) ,
. %>%
dplyr::mutate( MAD = round( mean( abs( TS - TS_theory ) , ) , 1 ) ,
MeanDelta = sprintf( "%0.1f" ,
round( mean ( TS - TS_theory ) , 1 ) ) ) %>%
dplyr::group_by( Group , MAD , MeanDelta ) %>%
dplyr::mutate( x = quantile( Frequency ,
0.1 ) ) %>%
dplyr::ungroup( ) %>%
dplyr::slice( 1 ) %>%
dplyr::mutate( y = -55 ,
label = paste0("MAD = ", sprintf("%0.1f", round( MAD , 1 ) ), " dB" ) ) %>%
dplyr::ungroup( ) ,
hjust = 0 ,
# parse = T ,
size = 4.75 ,
fontface = 'bold' ) +
ggplot2::geom_text( ggplot2::aes( x = x ,
y = y ,
label = label ) ,
. %>%
dplyr::mutate( MAD = round( mean( abs( TS - TS_theory ) , ) , 1 ) ,
MeanDelta = sprintf( "%0.1f" ,
round( mean ( TS - TS_theory ) , 1 ) ) ) %>%
dplyr::group_by( Group , MAD , MeanDelta ) %>%
dplyr::mutate( x = quantile( Frequency ,
0.1 ) ) %>%
dplyr::ungroup( ) %>%
dplyr::slice( 1 )  %>%
dplyr::mutate( y = -58 ,
label = paste("italic(Delta)*italic(TS)==", MeanDelta ,"~dB") ) ,
hjust = 0 ,
parse = T ,
check_overlap = T ,
size = 4.75 ,
fontface = 'bold' ) -> top
tib %>%
dplyr::mutate( DeltaTS = TS - TS_theory ) %>%
ggplot2::ggplot( ) +
ggplot2::geom_hline(
mapping = ggplot2::aes( yintercept = 0.0 ) ,
size = 1.05 ,
color = 'gray80' ,
linetype = 2
) +
ggplot2::geom_line(
mapping = ggplot2::aes( x = Frequency ,
y = DeltaTS ) ,
size = 1.25
) +
ggplot2::facet_wrap( ~ Group ,
scales = "free_x" ) +
ggplot2::coord_cartesian(
ylim = base::c( -22.0 , 22.0 ) ,
expand = 0
) +
ggplot2::labs( x = "Frequency (kHz)" ,
y = expression( Delta*italic('TS')~(italic('TS')['E']-italic('TS')['M']) ) ) +
ggplot2::theme_bw( ) +
ggplot2::scale_y_continuous( breaks = base::c( -10 , 0 , 10 ) ) -> bottom
if( alt_x == T ) {
top <- top + ggplot2::scale_x_continuous( breaks = base::c( 40 , 45 , 50 , 55 , 60 ,
130 , 160 , 190 ) )
bottom <- bottom + ggplot2::scale_x_continuous( breaks = base::c( 40 , 45 , 50 , 55 , 60 ,
130 , 160 , 190 ) )
} else {
top <- top + ggplot2::scale_x_continuous( breaks = base::c( 40 , 45 , 50 , 55 , 60 , 65 ,
130 , 150 , 170 , 190 , 210 ) )
bottom <- bottom + ggplot2::scale_x_continuous( breaks = base::c( 40 , 45 , 50 , 55 , 60 , 65 ,
130 , 150 , 170 , 190 ) )
}
if( blank == T) {
top <- top +
ggplot2::theme( text = ggplot2::element_text( size = 16.75 ,
color = 'black' ) ,
axis.text = ggplot2::element_text( size = 15.75 ,
color = 'black' ) ,
panel.grid = ggplot2::element_blank( ) ,
plot.margin = ggplot2::margin( 0.5 , 1 , 0 , 0 ) ,
axis.text.x = ggplot2::element_blank( ) ,
axis.ticks.length.x = ggplot2::unit( 0 , "lines" ) ,
strip.text = ggplot2::element_blank( ) ,
legend.text = ggplot2::element_text( hjust = 0 ) ,
panel.spacing.x = ggplot2::unit( 0 , "lines" ) ,
axis.text.y = ggplot2::element_blank( ) ,
axis.title.x = ggplot2::element_blank( ) ,
axis.title.y = ggplot2::element_blank( ) )
bottom <- bottom +
ggplot2::theme( text = ggplot2::element_text( size = 16.75 ,
color = 'black' ) ,
axis.text = ggplot2::element_text( size = 15.75 ,
color = 'black' ) ,
panel.grid = ggplot2::element_blank( ) ,
plot.margin = ggplot2::margin( 0.5 , 1 , 0 , 0 ) ,
strip.text = ggplot2::element_blank( ) ,
legend.text = ggplot2::element_text( hjust = 0 ) ,
panel.spacing.x = ggplot2::unit( 0 , "lines" ) ,
axis.text.y = ggplot2::element_blank( ) ,
axis.title.x = ggplot2::element_blank( ) ,
axis.title.y = ggplot2::element_blank( ) )
} else {
top <- top +
ggplot2::theme( text = ggplot2::element_text( size = 16.75 ,
color = 'black' ) ,
axis.text = ggplot2::element_text( size = 15.75 ,
color = 'black' ) ,
axis.text.x = ggplot2::element_blank( ) ,
axis.title.x = ggplot2::element_blank( ) ,
axis.ticks.length.x = ggplot2::unit( 0 , "lines" ) ,
panel.grid = ggplot2::element_blank( ) ,
plot.margin = ggplot2::margin( 0.5 , 1 , 0 , 0 ) ,
strip.text = ggplot2::element_blank( ) ,
legend.text = ggplot2::element_text( hjust = 0 ) ,
panel.spacing.x = ggplot2::unit( 0 , "lines" )
)
bottom <- bottom +
ggplot2::theme( text = ggplot2::element_text( size = 16.75 ,
color = 'black' ) ,
axis.text = ggplot2::element_text( size = 15.75 ,
color = 'black' ) ,
panel.grid = ggplot2::element_blank( ) ,
plot.margin = ggplot2::margin( 0.5 , 1 , 0 , 0 ) ,
strip.text = ggplot2::element_blank( ) ,
legend.text = ggplot2::element_text( hjust = 0 ) ,
panel.spacing.x = ggplot2::unit( 0 , "lines" )
)
}
top / bottom +
patchwork::plot_layout( heights = base::c( 4 , 2 ) )
}
( (
plot_fun( shrimp %>%
dplyr::filter( Animal == "917" ) ,
blank = F ,
alt_x = T )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "336" ) ,
blank = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "176" ) ,
alt_x = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "84" ) %>%
dplyr::mutate( Frequency = Frequency * 1e3 ) ,
blank = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) ) +
plot_layout( guides = 'collect' ,
widths = base::c( 2 , 1 , 2 , 1 ) )
save_directory <- "C:/Users/Brandyn/OneDrive - Stony Brook University/full_plot_TS_spectra.tiff"
width <- 1301
height <- 492
new_dpi <- 900
ggplot2::ggsave( filename = save_directory ,
plot = full_plotting ,
device = "tiff" ,
height = height * ( new_dpi / default_dpi ) ,
width =  width * ( new_dpi / default_dpi ) ,
dpi = new_dpi ,
compression = "lzw" ,
units = "px" )
height <-  522
new_dpi <- 900
ggplot2::ggsave( filename = save_directory ,
plot = full_plotting ,
device = "tiff" ,
height = height * ( new_dpi / default_dpi ) ,
width =  width * ( new_dpi / default_dpi ) ,
dpi = new_dpi ,
compression = "lzw" ,
units = "px" )
( (
plot_fun( shrimp %>%
dplyr::filter( Animal == "917" ) ,
blank = F ,
alt_x = T )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "336" ) ,
blank = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "176" ) ,
alt_x = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "84" ) %>%
dplyr::mutate( Frequency = Frequency * 1e3 ) ,
blank = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) ) +
plot_layout( guides = 'collect' ,
widths = base::c( 2 , 1 , 2 , 1 ) ) -> full_plotting
full_plotting
save_directory <- "C:/Users/Brandyn/OneDrive - Stony Brook University/full_plot_TS_spectra.tiff"
width <- 1301
height <-  522
new_dpi <- 900
ggplot2::ggsave( filename = save_directory ,
plot = full_plotting ,
device = "tiff" ,
height = height * ( new_dpi / default_dpi ) ,
width =  width * ( new_dpi / default_dpi ) ,
dpi = new_dpi ,
compression = "lzw" ,
units = "px" )
tib <- shrimp %>%
dplyr::filter( Animal == "176" )
tib %>%
ggplot2::ggplot(
mapping = ggplot2::aes( x = Frequency ,
group = Group )
) +
ggplot2::geom_line(
mapping = ggplot2::aes( y = ymin ,
group = Group ) ,
color = 'gray50' ,
size = 1.05
) +
ggplot2::geom_line(
mapping = ggplot2::aes( y = ymax ,
group = Group ) ,
color = 'gray50' ,
size = 1.05
) +
ggplot2::geom_line(
mapping = ggplot2::aes( y = TS_theory ,
color = "B" ) ,
size = 1.5
) +
ggplot2::geom_line(
mapping = ggplot2::aes( y = TS ,
color = "A" ) ,
size = 1.5
) +
ggplot2::geom_ribbon( ggplot2::aes( ymin = TS_min ,
ymax = TS_max ,
fill = "A" ) ,
alpha = 0.30 ) +
ggplot2::geom_ribbon( ggplot2::aes( ymin = ymin ,
ymax = ymax ,
fill = "B" ) ,
alpha = 0.00 ) +
ggplot2::scale_color_manual(
name = NULL ,
values = c( "red" ,
"black" ) ,
labels = c( expression( bar(italic('TS'))['E']) ,
'Best-fit'~italic('TS')['M'] )) +
ggplot2::scale_fill_manual(
name = NULL ,
values = c( "#fc9272" ,
"gray50" ) ,
drop = F ,
labels = c( expression( Range(italic('TS')['E']) ) ,
expression( Range(italic('TS')['M']))) ) +
ggplot2::scale_x_continuous(
breaks = base::c( 40 , 45 , 50 , 55 , 60 , 65 ,
130 , 150 , 170 , 190 , 210 )
) +
ggplot2::facet_wrap( ~ Group + Animal ,
scales = "free_x" ) +
ggplot2::coord_cartesian(
ylim = base::c( -95 , -48 ) ,
expand = 0
) +
ggplot2::theme_bw( ) +
# ggplot2::theme( text = ggplot2::element_text( size = 16.75 ,
#                                               color = 'black' ) ,
#                 axis.text = ggplot2::element_text( size = 15.75 ,
#                                                    color = 'black' ) ,
#                 panel.grid = ggplot2::element_blank( ) ,
#                 # # axis.title.y = ggplot2::element_blank( ) ,
#                 axis.text.x = ggplot2::element_blank( ) ,
#                 axis.title.x = ggplot2::element_blank( ) ,
#                 strip.text = ggplot2::element_blank( ) ,
#                 axis.ticks.length.x = ggplot2::unit( 0 , "lines" ) ,
#                 plot.margin = ggplot2::margin( 0 , 0 , 0 , -0.5 ) ,
#                 legend.text = ggplot2::element_text( hjust = 0 ) ,
#                 panel.spacing.x = ggplot2::unit( 0 , "lines" ) ) +
ggplot2::labs( x = "Frequency (kHz)" ,
y = expression( italic('TS')~('dB'~'re.'~1~'m'^2) ) ) +
facet_labs
tib
readr::read_csv( "I:/EN626.AN176.Shrimp_fit.csv" )
readr::read_csv( "I:/EN626.AN176.Shrimp_fit.csv" )$Group
unique(readr::read_csv( "I:/EN626.AN176.Shrimp_fit.csv" )$Group)
dplyr::bind_rows(
readr::read_csv( "I:/AR025.AN917.Shrimp_fit.csv" ) %>%
dplyr::mutate( Animal = "917" ,
Group = base::factor( Group ,
levels = base::c( "40 - 55 kHz" ,
"130 - 210 kHz" ) ) ) ,
readr::read_csv( "I:/EN626.AN076.Shrimp_fit.csv" ) %>%
dplyr::mutate( Animal = "76" ,
Group = base::factor( Group ,
levels = base::c( "40 - 55 kHz" ,
"130 - 210 kHz" ) ) ) ,
readr::read_csv( "I:/AR049.AN336.shrimp_fit.csv" ) %>%
dplyr::mutate( Animal = "336" ,
Group = base::factor( Group ,
levels = base::c( "40 - 55 kHz" ,
"130 - 210 kHz" ) ) )  ,
readr::read_csv( "I:/EN626.AN176.Shrimp_fit.csv" )  %>%
dplyr::mutate( Animal = "176" ,
Group = base::factor( Group ,
levels = base::c( "42 - 65 kHz" ,
"125 - 215 kHz" ) ) ) ,
readr::read_csv( "I:/AR049.AN084.pteropod_fit.csv" )  %>%
dplyr::mutate( Animal = "84" ,
Group = base::factor( Group ,
levels = base::c( "42 - 65 kHz" ,
"135 - 215 kHz" ) ) ) ,
readr::read_csv( "I:/EN626.AN183.pteropod_fit.csv" )  %>%
dplyr::mutate( Animal = "183" ,
Group = base::factor( Group ,
levels = base::c( "42 - 65 kHz" ,
"135 - 215 kHz" ) ) )
) %>%
dplyr::mutate( Frequency = Frequency * 1e-3 ) -> shrimp
( (
plot_fun( shrimp %>%
dplyr::filter( Animal == "917" ) ,
blank = F ,
alt_x = T )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "336" ) ,
blank = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "176" ) ,
alt_x = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) |
(
plot_fun( shrimp %>%
dplyr::filter( Animal == "84" ) %>%
dplyr::mutate( Frequency = Frequency * 1e3 ) ,
blank = T ) +
ggplot2::theme( axis.text.y = ggplot2::element_blank( ) )
) ) +
plot_layout( guides = 'collect' ,
widths = base::c( 2 , 1 , 2 , 1 ) ) -> full_plotting
full_plotting
save_directory <- "C:/Users/Brandyn/OneDrive - Stony Brook University/full_plot_TS_spectra.tiff"
width <- 1301
height <-  522
new_dpi <- 900
ggplot2::ggsave( filename = save_directory ,
plot = full_plotting ,
device = "tiff" ,
height = height * ( new_dpi / default_dpi ) ,
width =  width * ( new_dpi / default_dpi ) ,
dpi = new_dpi ,
compression = "lzw" ,
units = "px" )
